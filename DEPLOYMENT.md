# 🚀 Causal UI Gym - Production Deployment Guide\n\nThis guide covers the complete deployment process for Causal UI Gym, including infrastructure setup, monitoring, and operational procedures.\n\n## 📋 Deployment Checklist\n\n### Pre-Deployment\n- [ ] Quality gates passed (score ≥ 80%)\n- [ ] All tests passing\n- [ ] Security scan completed\n- [ ] Performance benchmarks met\n- [ ] Environment variables configured\n- [ ] SSL certificates ready\n- [ ] Monitoring configured\n- [ ] Backup strategy in place\n\n### Infrastructure\n- [ ] Kubernetes cluster ready\n- [ ] Docker images built and pushed\n- [ ] Load balancer configured\n- [ ] Database connections verified\n- [ ] CDN configured\n- [ ] DNS records updated\n\n### Post-Deployment\n- [ ] Health checks passing\n- [ ] Monitoring dashboards active\n- [ ] Error tracking operational\n- [ ] Performance metrics baseline\n- [ ] Rollback procedure tested\n\n## 🏗️ Architecture Overview\n\n```\n┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐\n│   Load Balancer │────│   React Frontend │────│      CDN        │\n│   (nginx)       │    │   (Vite Build)   │    │   (Static)      │\n└─────────────────┘    └──────────────────┘    └─────────────────┘\n                                │\n                                ▼\n┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐\n│   API Gateway   │────│  FastAPI Backend │────│   JAX Engine    │\n│   (Kong/Envoy)  │    │   (Python)       │    │   (GPU)         │\n└─────────────────┘    └──────────────────┘    └─────────────────┘\n                                │\n                                ▼\n┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐\n│   Monitoring    │    │    Database      │    │   Cache Layer   │\n│ (Prometheus)    │    │   (PostgreSQL)   │    │    (Redis)      │\n└─────────────────┘    └──────────────────┘    └─────────────────┘\n```\n\n## 🐳 Docker Configuration\n\n### Multi-stage Production Dockerfile\n\n```dockerfile\n# Build stage for frontend\nFROM node:18-alpine AS frontend-build\nWORKDIR /app\nCOPY package*.json ./\nRUN npm ci --only=production --no-audit\nCOPY . .\nRUN npm run build\n\n# Build stage for backend\nFROM python:3.11-slim AS backend-build\nWORKDIR /app\nCOPY requirements.txt .\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY backend/ ./backend/\n\n# Production stage\nFROM python:3.11-slim AS production\n\n# Install system dependencies\nRUN apt-get update && apt-get install -y \\\n    nginx \\\n    supervisor \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Copy built frontend\nCOPY --from=frontend-build /app/dist /usr/share/nginx/html\n\n# Copy backend\nCOPY --from=backend-build /app /app\n\n# Copy configuration\nCOPY deployment/nginx.conf /etc/nginx/nginx.conf\nCOPY deployment/supervisord.conf /etc/supervisor/conf.d/supervisord.conf\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \\\n    CMD curl -f http://localhost/health || exit 1\n\n# Run supervisor\nCMD [\"/usr/bin/supervisord\", \"-c\", \"/etc/supervisor/conf.d/supervisord.conf\"]\n```\n\n### Docker Compose Production\n\n```yaml\nversion: '3.8'\nservices:\n  app:\n    build:\n      context: .\n      dockerfile: Dockerfile\n      target: production\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    environment:\n      - NODE_ENV=production\n      - PYTHONPATH=/app\n    volumes:\n      - ./logs:/app/logs\n      - ./ssl:/etc/ssl/certs\n    restart: unless-stopped\n    depends_on:\n      - redis\n      - postgres\n    networks:\n      - app-network\n\n  redis:\n    image: redis:7-alpine\n    volumes:\n      - redis-data:/data\n    networks:\n      - app-network\n    restart: unless-stopped\n\n  postgres:\n    image: postgres:15-alpine\n    environment:\n      POSTGRES_DB: causal_ui_gym\n      POSTGRES_USER: ${DB_USER}\n      POSTGRES_PASSWORD: ${DB_PASSWORD}\n    volumes:\n      - postgres-data:/var/lib/postgresql/data\n    networks:\n      - app-network\n    restart: unless-stopped\n\n  prometheus:\n    image: prom/prometheus:latest\n    ports:\n      - \"9090:9090\"\n    volumes:\n      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml\n      - prometheus-data:/prometheus\n    networks:\n      - app-network\n    restart: unless-stopped\n\n  grafana:\n    image: grafana/grafana:latest\n    ports:\n      - \"3000:3000\"\n    environment:\n      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}\n    volumes:\n      - grafana-data:/var/lib/grafana\n    networks:\n      - app-network\n    restart: unless-stopped\n\nvolumes:\n  redis-data:\n  postgres-data:\n  prometheus-data:\n  grafana-data:\n\nnetworks:\n  app-network:\n    driver: bridge\n```\n\n## ⚓ Kubernetes Deployment\n\n### Application Deployment\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: causal-ui-gym\n  labels:\n    app: causal-ui-gym\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: causal-ui-gym\n  template:\n    metadata:\n      labels:\n        app: causal-ui-gym\n    spec:\n      containers:\n      - name: app\n        image: causal-ui-gym:latest\n        ports:\n        - containerPort: 80\n        - containerPort: 8000\n        env:\n        - name: NODE_ENV\n          value: \"production\"\n        - name: REDIS_URL\n          valueFrom:\n            secretKeyRef:\n              name: app-secrets\n              key: redis-url\n        - name: DATABASE_URL\n          valueFrom:\n            secretKeyRef:\n              name: app-secrets\n              key: database-url\n        resources:\n          requests:\n            cpu: 100m\n            memory: 256Mi\n          limits:\n            cpu: 500m\n            memory: 1Gi\n        livenessProbe:\n          httpGet:\n            path: /health\n            port: 80\n          initialDelaySeconds: 30\n          periodSeconds: 10\n        readinessProbe:\n          httpGet:\n            path: /health\n            port: 80\n          initialDelaySeconds: 5\n          periodSeconds: 5\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: causal-ui-gym-service\nspec:\n  selector:\n    app: causal-ui-gym\n  ports:\n    - name: http\n      protocol: TCP\n      port: 80\n      targetPort: 80\n    - name: api\n      protocol: TCP\n      port: 8000\n      targetPort: 8000\n  type: ClusterIP\n---\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: causal-ui-gym-ingress\n  annotations:\n    kubernetes.io/ingress.class: nginx\n    cert-manager.io/cluster-issuer: letsencrypt-prod\n    nginx.ingress.kubernetes.io/ssl-redirect: \"true\"\nspec:\n  tls:\n  - hosts:\n    - causal-ui-gym.yourdomain.com\n    secretName: causal-ui-gym-tls\n  rules:\n  - host: causal-ui-gym.yourdomain.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          service:\n            name: causal-ui-gym-service\n            port:\n              number: 80\n      - path: /api\n        pathType: Prefix\n        backend:\n          service:\n            name: causal-ui-gym-service\n            port:\n              number: 8000\n```\n\n### Horizontal Pod Autoscaler\n\n```yaml\napiVersion: autoscaling/v2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: causal-ui-gym-hpa\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: causal-ui-gym\n  minReplicas: 3\n  maxReplicas: 10\n  metrics:\n  - type: Resource\n    resource:\n      name: cpu\n      target:\n        type: Utilization\n        averageUtilization: 70\n  - type: Resource\n    resource:\n      name: memory\n      target:\n        type: Utilization\n        averageUtilization: 80\n```\n\n## 🔐 Security Configuration\n\n### Environment Variables\n\n```bash\n# Production Environment Variables\nexport NODE_ENV=production\nexport API_URL=https://api.causal-ui-gym.com\nexport DATABASE_URL=postgresql://user:pass@localhost:5432/causal_ui_gym\nexport REDIS_URL=redis://localhost:6379\nexport JWT_SECRET=your-super-secret-jwt-key\nexport ENCRYPTION_KEY=your-32-char-encryption-key\nexport SENTRY_DSN=https://your-sentry-dsn\nexport LOG_LEVEL=info\n\n# GPU Configuration\nexport CUDA_VISIBLE_DEVICES=0,1\nexport JAX_PLATFORM_NAME=gpu\n\n# Performance Tuning\nexport WORKERS=4\nexport MAX_CONNECTIONS=1000\nexport CACHE_TTL=3600\n```\n\n### SSL/TLS Configuration\n\n```nginx\n# nginx SSL configuration\nserver {\n    listen 443 ssl http2;\n    server_name causal-ui-gym.yourdomain.com;\n    \n    ssl_certificate /etc/ssl/certs/fullchain.pem;\n    ssl_certificate_key /etc/ssl/private/privkey.pem;\n    \n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;\n    ssl_prefer_server_ciphers off;\n    \n    add_header Strict-Transport-Security \"max-age=63072000\" always;\n    add_header X-Frame-Options DENY;\n    add_header X-Content-Type-Options nosniff;\n    add_header Referrer-Policy \"strict-origin-when-cross-origin\";\n    \n    location / {\n        try_files $uri $uri/ /index.html;\n    }\n    \n    location /api {\n        proxy_pass http://127.0.0.1:8000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n```\n\n## 📊 Monitoring and Observability\n\n### Prometheus Configuration\n\n```yaml\nglobal:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nrule_files:\n  - \"alert_rules.yml\"\n\nalerting:\n  alertmanagers:\n    - static_configs:\n        - targets:\n          - alertmanager:9093\n\nscrape_configs:\n  - job_name: 'causal-ui-gym'\n    static_configs:\n      - targets: ['app:8000']\n    metrics_path: '/metrics'\n    scrape_interval: 10s\n  \n  - job_name: 'node-exporter'\n    static_configs:\n      - targets: ['node-exporter:9100']\n  \n  - job_name: 'redis'\n    static_configs:\n      - targets: ['redis-exporter:9121']\n```\n\n### Alert Rules\n\n```yaml\ngroups:\n- name: causal-ui-gym-alerts\n  rules:\n  - alert: HighErrorRate\n    expr: rate(http_requests_total{status=~\"5..\"}[5m]) > 0.1\n    for: 2m\n    labels:\n      severity: critical\n    annotations:\n      summary: \"High error rate detected\"\n      description: \"Error rate is {{ $value }} errors per second\"\n  \n  - alert: HighMemoryUsage\n    expr: (process_resident_memory_bytes / (1024*1024)) > 1000\n    for: 5m\n    labels:\n      severity: warning\n    annotations:\n      summary: \"High memory usage\"\n      description: \"Memory usage is {{ $value }}MB\"\n  \n  - alert: DatabaseConnectionFailed\n    expr: up{job=\"postgres\"} == 0\n    for: 1m\n    labels:\n      severity: critical\n    annotations:\n      summary: \"Database connection failed\"\n      description: \"Cannot connect to PostgreSQL database\"\n```\n\n## 🚀 Deployment Scripts\n\n### Automated Deployment Script\n\n```bash\n#!/bin/bash\nset -e\n\necho \"🚀 Starting Causal UI Gym deployment...\"\n\n# Configuration\nIMAGE_NAME=\"causal-ui-gym\"\nIMAGE_TAG=\"${GITHUB_SHA:-latest}\"\nREGISTRY=\"your-registry.com\"\nKUBE_NAMESPACE=\"production\"\n\n# Pre-deployment checks\necho \"🔍 Running pre-deployment checks...\"\npython3 scripts/quality-gates.py\nif [ $? -ne 0 ]; then\n    echo \"❌ Quality gates failed. Deployment aborted.\"\n    exit 1\nfi\n\n# Build and push Docker image\necho \"🐳 Building Docker image...\"\ndocker build -t $IMAGE_NAME:$IMAGE_TAG .\ndocker tag $IMAGE_NAME:$IMAGE_TAG $REGISTRY/$IMAGE_NAME:$IMAGE_TAG\ndocker push $REGISTRY/$IMAGE_NAME:$IMAGE_TAG\n\n# Update Kubernetes deployment\necho \"⚓ Deploying to Kubernetes...\"\nkubectl set image deployment/causal-ui-gym app=$REGISTRY/$IMAGE_NAME:$IMAGE_TAG -n $KUBE_NAMESPACE\nkubectl rollout status deployment/causal-ui-gym -n $KUBE_NAMESPACE --timeout=300s\n\n# Health check\necho \"🏥 Running health checks...\"\nsleep 30\nHEALTH_STATUS=$(curl -f -s http://your-app-url/health | jq -r '.status')\nif [ \"$HEALTH_STATUS\" != \"healthy\" ]; then\n    echo \"❌ Health check failed. Rolling back...\"\n    kubectl rollout undo deployment/causal-ui-gym -n $KUBE_NAMESPACE\n    exit 1\nfi\n\n# Performance validation\necho \"📊 Running performance validation...\"\npython3 scripts/performance-test.py --url=http://your-app-url\n\necho \"✅ Deployment completed successfully!\"\necho \"📊 Dashboard: https://grafana.yourdomain.com\"\necho \"🚨 Alerts: https://alertmanager.yourdomain.com\"\n```\n\n### Database Migration Script\n\n```python\n#!/usr/bin/env python3\n\"\"\"\nDatabase migration script for production deployments.\n\"\"\"\n\nimport os\nimport sys\nimport psycopg2\nfrom pathlib import Path\n\ndef run_migrations():\n    \"\"\"Run database migrations safely.\"\"\"\n    db_url = os.getenv('DATABASE_URL')\n    if not db_url:\n        print(\"❌ DATABASE_URL not set\")\n        sys.exit(1)\n    \n    try:\n        conn = psycopg2.connect(db_url)\n        cursor = conn.cursor()\n        \n        # Create migrations table if not exists\n        cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS schema_migrations (\n                version VARCHAR(255) PRIMARY KEY,\n                applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n            )\n        \"\"\")\n        \n        # Get current migration version\n        cursor.execute(\"SELECT version FROM schema_migrations ORDER BY version DESC LIMIT 1\")\n        current_version = cursor.fetchone()\n        current_version = current_version[0] if current_version else '000'\n        \n        # Find and apply new migrations\n        migrations_dir = Path(__file__).parent.parent / 'migrations'\n        migration_files = sorted(migrations_dir.glob('*.sql'))\n        \n        for migration_file in migration_files:\n            version = migration_file.stem\n            if version > current_version:\n                print(f\"📄 Applying migration: {version}\")\n                \n                with open(migration_file, 'r') as f:\n                    migration_sql = f.read()\n                \n                cursor.execute(migration_sql)\n                cursor.execute(\n                    \"INSERT INTO schema_migrations (version) VALUES (%s)\",\n                    (version,)\n                )\n                \n        conn.commit()\n        print(\"✅ All migrations applied successfully\")\n        \n    except Exception as e:\n        print(f\"❌ Migration failed: {e}\")\n        conn.rollback()\n        sys.exit(1)\n    finally:\n        conn.close()\n\nif __name__ == '__main__':\n    run_migrations()\n```\n\n## 🔄 CI/CD Pipeline\n\n### GitHub Actions Workflow\n\n```yaml\nname: Deploy to Production\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v3\n    \n    - name: Setup Node.js\n      uses: actions/setup-node@v3\n      with:\n        node-version: '18'\n        cache: 'npm'\n    \n    - name: Setup Python\n      uses: actions/setup-python@v4\n      with:\n        python-version: '3.11'\n    \n    - name: Install dependencies\n      run: |\n        npm install\n        pip install -r requirements.txt\n    \n    - name: Run quality gates\n      run: python3 scripts/quality-gates.py\n    \n    - name: Run tests\n      run: |\n        npm test\n        python -m pytest tests/\n    \n    - name: Build application\n      run: npm run build\n    \n    - name: Security scan\n      uses: securecodewarrior/github-action-add-sarif@v1\n      with:\n        sarif-file: 'security-scan-results.sarif'\n\n  deploy:\n    needs: test\n    runs-on: ubuntu-latest\n    if: github.ref == 'refs/heads/main'\n    \n    steps:\n    - uses: actions/checkout@v3\n    \n    - name: Configure AWS credentials\n      uses: aws-actions/configure-aws-credentials@v2\n      with:\n        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}\n        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\n        aws-region: us-west-2\n    \n    - name: Login to Amazon ECR\n      uses: aws-actions/amazon-ecr-login@v1\n    \n    - name: Build and push Docker image\n      env:\n        ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}\n        ECR_REPOSITORY: causal-ui-gym\n        IMAGE_TAG: ${{ github.sha }}\n      run: |\n        docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG .\n        docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG\n    \n    - name: Deploy to EKS\n      run: |\n        aws eks update-kubeconfig --name production-cluster\n        kubectl set image deployment/causal-ui-gym app=$ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG\n        kubectl rollout status deployment/causal-ui-gym --timeout=300s\n    \n    - name: Run smoke tests\n      run: python3 scripts/smoke-tests.py --url=https://causal-ui-gym.com\n    \n    - name: Notify deployment\n      uses: 8398a7/action-slack@v3\n      with:\n        status: ${{ job.status }}\n        channel: '#deployments'\n        webhook_url: ${{ secrets.SLACK_WEBHOOK }}\n```\n\n## 📈 Performance Optimization\n\n### CDN Configuration\n\n```javascript\n// Cloudflare Workers script for edge caching\nexport default {\n  async fetch(request, env, ctx) {\n    const url = new URL(request.url)\n    \n    // Cache static assets\n    if (url.pathname.match(/\\.(js|css|png|jpg|jpeg|gif|ico|svg)$/)) {\n      const cache = caches.default\n      const cacheKey = new Request(url.toString(), request)\n      \n      let response = await cache.match(cacheKey)\n      if (!response) {\n        response = await fetch(request)\n        if (response.ok) {\n          const newHeaders = new Headers(response.headers)\n          newHeaders.set('Cache-Control', 'public, max-age=86400')\n          response = new Response(response.body, {\n            status: response.status,\n            statusText: response.statusText,\n            headers: newHeaders\n          })\n          ctx.waitUntil(cache.put(cacheKey, response.clone()))\n        }\n      }\n      return response\n    }\n    \n    // Pass through API requests\n    return fetch(request)\n  }\n}\n```\n\n## 🔧 Maintenance Procedures\n\n### Backup Strategy\n\n```bash\n#!/bin/bash\n# Automated backup script\n\nBACKUP_DATE=$(date +%Y%m%d_%H%M%S)\nBACKUP_DIR=\"/backups/causal-ui-gym/$BACKUP_DATE\"\n\n# Create backup directory\nmkdir -p $BACKUP_DIR\n\n# Database backup\npg_dump $DATABASE_URL > $BACKUP_DIR/database.sql\n\n# Redis backup\nredis-cli SAVE\ncp /var/lib/redis/dump.rdb $BACKUP_DIR/\n\n# Application data backup\ntar -czf $BACKUP_DIR/app-data.tar.gz /app/data\n\n# Upload to S3\naws s3 sync $BACKUP_DIR s3://causal-ui-gym-backups/$BACKUP_DATE/\n\n# Cleanup old backups (keep last 30 days)\nfind /backups/causal-ui-gym -type d -mtime +30 -exec rm -rf {} +\n\necho \"✅ Backup completed: $BACKUP_DATE\"\n```\n\n### Rollback Procedure\n\n```bash\n#!/bin/bash\n# Emergency rollback script\n\nset -e\n\nPREVIOUS_VERSION=${1:-\"previous\"}\n\necho \"🔄 Rolling back to version: $PREVIOUS_VERSION\"\n\n# Kubernetes rollback\nkubectl rollout undo deployment/causal-ui-gym -n production\nkubectl rollout status deployment/causal-ui-gym -n production --timeout=300s\n\n# Verify rollback\necho \"🏥 Verifying rollback...\"\nsleep 30\nHEALTH_STATUS=$(curl -f -s https://causal-ui-gym.com/health | jq -r '.status')\n\nif [ \"$HEALTH_STATUS\" == \"healthy\" ]; then\n    echo \"✅ Rollback successful\"\nelse\n    echo \"❌ Rollback verification failed\"\n    exit 1\nfi\n```\n\n## 📞 Operations Runbook\n\n### Common Issues and Solutions\n\n| Issue | Symptoms | Solution |\n|-------|----------|----------|\n| High CPU Usage | Response time > 2s | Scale horizontally, check for inefficient queries |\n| Memory Leaks | Growing memory usage | Restart pods, investigate caching issues |\n| Database Locks | Slow queries | Identify and kill long-running queries |\n| SSL Certificate Expiry | Browser warnings | Update certificate with cert-manager |\n| Cache Issues | Stale data | Clear Redis cache, check TTL settings |\n\n### Emergency Contacts\n\n- **On-Call Engineer**: +1-xxx-xxx-xxxx\n- **DevOps Team**: devops@company.com\n- **Product Owner**: product@company.com\n\n### Monitoring Dashboards\n\n- **Application**: https://grafana.yourdomain.com/d/app-dashboard\n- **Infrastructure**: https://grafana.yourdomain.com/d/infra-dashboard\n- **Business Metrics**: https://grafana.yourdomain.com/d/business-dashboard\n\n---\n\n**📚 Additional Resources**\n- [API Documentation](./docs/API_DOCUMENTATION.md)\n- [Security Architecture](./docs/SECURITY_ARCHITECTURE.md)\n- [Performance Tuning Guide](./docs/PERFORMANCE.md)\n- [Troubleshooting Guide](./docs/TROUBLESHOOTING.md)\n\n**🆘 Emergency Procedures**\n- [Incident Response Plan](./docs/INCIDENT_RESPONSE.md)\n- [Disaster Recovery Plan](./DISASTER_RECOVERY.md)\n- [Business Continuity Plan](./docs/BUSINESS_CONTINUITY.md)\n"